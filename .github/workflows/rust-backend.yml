name: Rust Backend CI

on:
push:
branches:
- main
pull_request:
branches:
- main

jobs:
build-and-test:
runs-on: ubuntu-latest

steps:
- name: Checkout code
uses: actions/checkout@v4

- name: Set up Rust
uses: actions-rs/toolchain@v1
with:
toolchain: stable
override: true
profile: minimal

- name: Cache Cargo dependencies
uses: actions/cache@v4
with:
path: |
~/.cargo/registry
~/.cargo/git
target
key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}
restore-keys: |
${{ runner.os }}-cargo-

- name: Run cargo build
run: cargo build

- name: Run cargo test
run: cargo test

- name: Run cargo clippy
run: cargo clippy -- -D warnings

- name: Run cargo fmt
run: cargo fmt --check

- name: Install cargo-audit
run: cargo install cargo-audit

- name: Run cargo audit
run: cargo audit